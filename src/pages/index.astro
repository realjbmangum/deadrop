---
export const prerender = false;
import { getBrandConfig } from '../lib/config';
const kv = Astro.locals.runtime.env.DEADROP_SECRETS;
const brand = await getBrandConfig(kv, Astro.url.hostname);

function hexToRgb(hex: string): string {
  const c = hex.replace('#', '');
  return `${parseInt(c.slice(0,2),16)}, ${parseInt(c.slice(2,4),16)}, ${parseInt(c.slice(4,6),16)}`;
}
const accentColor = brand.primaryColor || '#00FF88';
const accentRgb   = hexToRgb(accentColor);
const isCustomBrand = accentColor.toUpperCase() !== '#00FF88';
---

<html lang="en" style={`--accent: ${accentColor}; --accent-rgb: ${accentRgb};`}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{brand.name} — {brand.tagline}</title>
    <meta name="description" content={`${brand.name}: Zero-knowledge self-destructing secret sharing. ${brand.tagline}`} />
    <link rel="icon" type="image/png" href="/Logo.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700;800&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet" />
    <!-- Avoid FOUC: apply saved theme before paint (default brand only) -->
    {!isCustomBrand && (
      <script>
        const t = localStorage.getItem('deadrop-theme');
        if (t === 'red') document.documentElement.setAttribute('data-theme', 'red');
      </script>
    )}
  </head>
  <body class="min-h-screen bg-[#0D0D12] text-gray-200 antialiased">

    <!-- Atmospheric glow -->
    <div aria-hidden="true" class="fixed inset-0 pointer-events-none overflow-hidden">
      <div class="atmo-glow absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/3 w-[700px] h-[700px] rounded-full"></div>
    </div>

    <!-- Grid background -->
    <div aria-hidden="true" class="fixed inset-0 pointer-events-none grid-bg"></div>

    <!-- Theme switcher (hidden for white-label deployments) -->
    {!isCustomBrand && (
      <div class="fixed top-4 right-5 z-20 flex items-center gap-2" role="group" aria-label="Color theme">
        <span class="text-[9px] font-mono text-[#4A4A6A] tracking-widest uppercase hidden sm:block">THEME</span>
        <button class="theme-dot" data-theme-target="green" aria-label="Green theme" aria-pressed="true"></button>
        <button class="theme-dot" data-theme-target="red" aria-label="Red theme" aria-pressed="false"></button>
      </div>
    )}

    <main class="relative max-w-[740px] mx-auto px-6 py-14 sm:py-24">

      <!-- Header -->
      <header class="mb-8 reveal">

        <!-- Logo + headline stacked centered -->
        <div class="text-center">
          <img src={brand.logo || '/Logo.png'} alt={`${brand.name} logo`} width="160" height="160" class="mx-auto mb-6" />
          <h1 class="font-mono font-extrabold text-white leading-none mb-4" style="font-size: clamp(3.5rem, 10vw, 6rem); font-family: 'JetBrains Mono', monospace; letter-spacing: -0.02em;">
            {brand.name}<span class="accent-text cursor-blink">_</span>
          </h1>
          <p class="text-base text-[#9090AA]" style="font-family: 'IBM Plex Sans', sans-serif;">{brand.tagline}</p>
        </div>

      </header>

      <!-- Feature badges -->
      <div class="flex flex-wrap justify-center gap-2 mb-8 reveal" style="animation-delay: 0.05s" aria-hidden="true">
        <span class="badge">ZERO-KNOWLEDGE</span>
        <span class="badge">BURNS ON VIEW</span>
        <span class="badge">AES-256-GCM</span>
        <span class="badge">CLIENT-SIDE KEY</span>
      </div>

      <!-- Create form -->
      <div id="create-form" class="reveal" style="animation-delay: 0.1s">

        <!-- Stacked card -->
        <div class="form-card">

          <!-- Secret input -->
          <div class="form-section">
            <div class="flex items-center justify-between mb-2.5">
              <label for="secret-input" class="field-label">SECRET</label>
              <button id="gen-btn" type="button" class="gen-btn" title="Generate random password">
                ⚡ GENERATE
              </button>
            </div>
            <textarea
              id="secret-input"
              rows="6"
              maxlength="10000"
              placeholder="Paste your password, API key, or sensitive text..."
              class="w-full bg-[#080810] border border-[#1A1A2E] rounded-lg px-4 py-3 text-[#E0E0F0] font-mono text-base placeholder-[#3E3E58] focus:outline-none transition-all resize-none leading-relaxed input-accent"
            ></textarea>
            <div class="mt-2 flex justify-between text-xs font-mono">
              <span class="text-[#6A6A88]">AES-GCM-256 · key never leaves your browser</span>
              <span id="char-count" class="text-[#6A6A88]">0 / 10,000</span>
            </div>
          </div>

          <!-- TTL slider -->
          <div class="form-section border-t border-[#141420]">
            <div class="flex items-center justify-between mb-3">
              <label class="field-label">EXPIRES AFTER</label>
              <span id="ttl-display" class="slider-val">7 DAYS</span>
            </div>
            <input type="range" id="ttl-slider" min="0" max="7" step="1" value="5" class="range-slider" />
            <div class="flex justify-between mt-2.5 text-xs font-mono text-[#6A6A88] select-none">
              <span>1H</span><span>6H</span><span>12H</span><span>1D</span><span>3D</span><span>7D</span><span>14D</span><span>30D</span>
            </div>
          </div>

          <!-- View limit slider -->
          <div class="form-section border-t border-[#141420]">
            <div class="flex items-center justify-between mb-3">
              <label class="field-label">MAX VIEWS</label>
              <span id="views-display" class="slider-val">1 VIEW</span>
            </div>
            <input type="range" id="views-slider" min="1" max="10" step="1" value="1" class="range-slider" />
            <div class="flex justify-between mt-2.5 text-xs font-mono text-[#6A6A88] select-none">
              {[1,2,3,4,5,6,7,8,9,10].map(n => <span>{n}</span>)}
            </div>
          </div>

          <!-- Passphrase (optional) -->
          <div class="form-section border-t border-[#141420]">
            <button id="passphrase-toggle" type="button" class="passphrase-toggle flex items-center gap-2.5 text-[12px] font-mono text-[#7070908] transition-colors w-full text-left focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 rounded">
              <span id="passphrase-indicator" class="pp-indicator w-4 h-4 border border-[#2A2A40] rounded flex items-center justify-center text-[9px] flex-shrink-0 transition-all"></span>
              <span class="text-[#8080A0]">ADD PASSPHRASE</span>
              <span class="text-[#5A5A78] normal-case font-normal ml-0.5 text-[11px]" style="font-family: 'IBM Plex Sans', sans-serif;">— recipient must enter a passphrase to reveal</span>
            </button>
            <div id="passphrase-field" class="hidden mt-3">
              <input
                type="password"
                id="passphrase-input"
                placeholder="Enter a passphrase..."
                autocomplete="off"
                class="w-full bg-[#080810] border border-[#1A1A2E] rounded-lg px-4 py-2.5 text-[#E0E0F0] font-mono text-sm placeholder-[#3E3E58] focus:outline-none transition-all input-accent"
              />
              <p class="mt-2 text-[11px] font-mono text-[#6A6A88]">Share the passphrase separately. The link is useless without it.</p>
            </div>
          </div>

        </div>

        <!-- Submit button -->
        <button id="create-btn" type="button" class="create-btn mt-4">
          <span id="create-btn-text">CREATE DEADROP →</span>
        </button>

        <!-- Error -->
        <div id="create-error" class="hidden mt-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-400 text-sm font-mono"></div>
      </div>

      <!-- Result section (hidden until created) -->
      <div id="result-section" class="hidden reveal-fast">

        <div class="result-card">
          <div class="flex items-center justify-between pb-4 mb-5 border-b border-[#141420]">
            <span class="text-[11px] font-mono tracking-wider accent-text">// DEADROP CREATED</span>
            <span id="result-meta" class="text-[11px] font-mono text-[#6A6A88]"></span>
          </div>

          <label class="field-label mb-2 block">SHARE LINK</label>
          <div class="relative">
            <input
              id="result-link"
              type="text"
              readonly
              class="w-full bg-[#080810] border border-[#1A1A2E] rounded-lg pl-4 pr-24 py-3 accent-text font-mono text-xs focus:outline-none select-all"
            />
            <button id="copy-btn" type="button" class="copy-btn">COPY</button>
          </div>

          <div class="mt-4 p-3 rounded-lg accent-note">
            <p class="text-[11px] font-mono accent-note-text leading-relaxed">
              KEY IS IN URL FRAGMENT (#). Never transmitted to server. Closing this tab without copying means the key is gone.
            </p>
          </div>
        </div>

        <button id="big-copy-btn" type="button" class="create-btn mt-4">
          COPY LINK TO CLIPBOARD
        </button>

        <button id="create-another" type="button" class="mt-3 w-full py-3 text-sm font-mono text-[#6A6A88] hover:text-gray-400 transition-colors">
          ← CREATE ANOTHER
        </button>
      </div>

      <footer class="mt-16 pt-6 border-t border-[#141420] text-center">
        <p class="text-[11px] font-mono text-[#5A5A78]">
          ZERO-KNOWLEDGE · OPEN SOURCE · {brand.name}
        </p>
      </footer>

    </main>

    <style>
      :root {
        --accent: #00FF88;
        --accent-rgb: 0, 255, 136;
      }
      [data-theme="red"] {
        --accent: #FF3355;
        --accent-rgb: 255, 51, 85;
      }

      body { font-family: 'IBM Plex Sans', system-ui, sans-serif; }

      /* Accent utilities */
      .accent-text  { color: var(--accent); }
      .accent-fill  { fill: var(--accent); }
      .accent-stroke { stroke: var(--accent); }
      .accent-note {
        border: 1px solid rgba(var(--accent-rgb), 0.12);
        background: rgba(var(--accent-rgb), 0.03);
        border-radius: 10px;
      }
      .accent-note-text { color: rgba(var(--accent-rgb), 0.55); }

      /* Atmospheric glow */
      .atmo-glow {
        background: radial-gradient(circle, rgba(var(--accent-rgb), 0.07) 0%, transparent 65%);
      }

      /* Grid background */
      .grid-bg {
        background-image:
          linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
          linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
        background-size: 40px 40px;
      }

      /* Feature badges */
      .badge {
        font-family: 'JetBrains Mono', monospace;
        font-size: 11px;
        font-weight: 700;
        letter-spacing: 0.15em;
        color: rgba(var(--accent-rgb), 0.65);
        border: 1px solid rgba(var(--accent-rgb), 0.18);
        border-radius: 4px;
        padding: 5px 12px;
        background: rgba(var(--accent-rgb), 0.04);
      }

      /* Theme dots */
      .theme-dot {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.2s;
        padding: 0;
      }
      .theme-dot[data-theme-target="green"] { background: #00FF88; }
      .theme-dot[data-theme-target="red"]   { background: #FF3355; }
      .theme-dot[data-theme-target="green"].active {
        box-shadow: 0 0 0 2px rgba(255,255,255,0.25), 0 0 10px rgba(0,255,136,0.7);
      }
      .theme-dot[data-theme-target="red"].active {
        box-shadow: 0 0 0 2px rgba(255,255,255,0.25), 0 0 10px rgba(255,51,85,0.7);
      }
      .theme-dot:focus-visible { outline: 2px solid var(--accent); outline-offset: 3px; }

      .cursor-blink { animation: blink 1.2s step-end infinite; }
      @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

      .reveal { opacity: 0; transform: translateY(12px); animation: revealUp 0.5s ease forwards; }
      .reveal-fast { animation: revealUp 0.3s ease forwards; }
      @keyframes revealUp { to { opacity: 1; transform: translateY(0); } }

      .form-card {
        background: #111119;
        border: 1px solid #1C1C2C;
        border-radius: 14px;
        overflow: hidden;
      }
      .form-section { padding: 1.5rem 2rem; }

      .field-label {
        font-family: 'JetBrains Mono', monospace;
        font-size: 11px;
        font-weight: 700;
        letter-spacing: 0.18em;
        color: #7A7A9A;
        text-transform: uppercase;
      }

      .slider-val {
        font-family: 'JetBrains Mono', monospace;
        font-size: 15px;
        font-weight: 700;
        color: var(--accent);
        text-shadow: 0 0 12px rgba(var(--accent-rgb), 0.4);
      }

      .gen-btn {
        font-family: 'JetBrains Mono', monospace;
        font-size: 11px;
        font-weight: 700;
        letter-spacing: 0.1em;
        color: #6A6A8A;
        border: 1px solid #282840;
        border-radius: 6px;
        padding: 5px 12px;
        background: transparent;
        cursor: pointer;
        transition: all 0.2s;
      }
      .gen-btn:hover {
        color: var(--accent);
        border-color: rgba(var(--accent-rgb), 0.4);
        box-shadow: 0 0 10px rgba(var(--accent-rgb), 0.1);
      }

      /* Input accent focus state */
      .input-accent:focus {
        border-color: var(--accent) !important;
        box-shadow: 0 0 0 1px rgba(var(--accent-rgb), 0.2) !important;
      }

      /* Passphrase toggle */
      .passphrase-toggle { color: #7878A0; }
      .passphrase-toggle:hover { color: var(--accent); }
      .passphrase-toggle:focus-visible { outline: 2px solid var(--accent); }

      /* Range slider */
      .range-slider {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 2px;
        background: #1A1A2E;
        outline: none;
        cursor: pointer;
        border-radius: 2px;
      }
      .range-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: var(--accent);
        cursor: pointer;
        box-shadow: 0 0 10px rgba(var(--accent-rgb), 0.6), 0 0 20px rgba(var(--accent-rgb), 0.2);
        transition: box-shadow 0.2s;
      }
      .range-slider::-webkit-slider-thumb:hover {
        box-shadow: 0 0 14px rgba(var(--accent-rgb), 0.8), 0 0 28px rgba(var(--accent-rgb), 0.3);
      }
      .range-slider::-moz-range-thumb {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: var(--accent);
        cursor: pointer;
        border: none;
        box-shadow: 0 0 10px rgba(var(--accent-rgb), 0.6);
      }

      /* Create / CTA button */
      .create-btn {
        width: 100%;
        padding: 18px;
        background: var(--accent);
        color: #050508;
        font-family: 'JetBrains Mono', monospace;
        font-size: 15px;
        font-weight: 800;
        letter-spacing: 0.08em;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s;
        display: block;
      }
      .create-btn:hover {
        filter: brightness(1.1);
        box-shadow: 0 0 28px rgba(var(--accent-rgb), 0.4), 0 4px 16px rgba(var(--accent-rgb), 0.2);
        transform: translateY(-1px);
      }
      .create-btn:active { transform: scale(0.99); filter: none; }
      .create-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; box-shadow: none; filter: none; }

      .result-card {
        background: #111119;
        border: 1px solid #1C1C2C;
        border-radius: 14px;
        padding: 1.5rem;
      }

      .copy-btn {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        padding: 6px 14px;
        background: rgba(var(--accent-rgb), 0.08);
        color: var(--accent);
        font-family: 'JetBrains Mono', monospace;
        font-size: 10px;
        font-weight: 700;
        letter-spacing: 0.1em;
        border: 1px solid rgba(var(--accent-rgb), 0.2);
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .copy-btn:hover {
        background: rgba(var(--accent-rgb), 0.15);
        border-color: rgba(var(--accent-rgb), 0.4);
      }

      @media (prefers-reduced-motion: reduce) {
        .reveal, .reveal-fast, .cursor-blink { animation: none !important; opacity: 1; transform: none; }
      }
    </style>

    <script>
      import { encryptSecret, encryptWithPassphrase, generatePassword } from '../lib/crypto';

      const TTL_OPTIONS = [
        { label: '1 HOUR',   seconds: 3_600 },
        { label: '6 HOURS',  seconds: 21_600 },
        { label: '12 HOURS', seconds: 43_200 },
        { label: '1 DAY',    seconds: 86_400 },
        { label: '3 DAYS',   seconds: 259_200 },
        { label: '7 DAYS',   seconds: 604_800 },
        { label: '14 DAYS',  seconds: 1_209_600 },
        { label: '30 DAYS',  seconds: 2_592_000 },
      ];

      const secretInput    = document.getElementById('secret-input') as HTMLTextAreaElement;
      const charCount      = document.getElementById('char-count')!;
      const genBtn         = document.getElementById('gen-btn')!;
      const ttlSlider      = document.getElementById('ttl-slider') as HTMLInputElement;
      const ttlDisplay     = document.getElementById('ttl-display')!;
      const viewsSlider    = document.getElementById('views-slider') as HTMLInputElement;
      const viewsDisplay   = document.getElementById('views-display')!;
      const ppToggle       = document.getElementById('passphrase-toggle')!;
      const ppIndicator    = document.getElementById('passphrase-indicator')!;
      const ppField        = document.getElementById('passphrase-field')!;
      const ppInput        = document.getElementById('passphrase-input') as HTMLInputElement;
      const createBtn      = document.getElementById('create-btn') as HTMLButtonElement;
      const createBtnText  = document.getElementById('create-btn-text')!;
      const createError    = document.getElementById('create-error')!;
      const createForm     = document.getElementById('create-form')!;
      const resultSection  = document.getElementById('result-section')!;
      const resultLink     = document.getElementById('result-link') as HTMLInputElement;
      const resultMeta     = document.getElementById('result-meta')!;
      const copyBtn        = document.getElementById('copy-btn')!;
      const bigCopyBtn     = document.getElementById('big-copy-btn')!;
      const createAnother  = document.getElementById('create-another')!;
      const themeDots      = document.querySelectorAll<HTMLButtonElement>('.theme-dot');

      let passphraseEnabled = false;
      let accentColor = '#00FF88';

      // ── Theme ──────────────────────────────────────────────────────────────────
      function applyTheme(theme: 'green' | 'red', persist = true) {
        const isRed = theme === 'red';
        accentColor = isRed ? '#FF3355' : '#00FF88';
        document.documentElement.setAttribute('data-theme', theme);
        if (persist) localStorage.setItem('deadrop-theme', theme);

        themeDots.forEach(dot => {
          const active = dot.dataset.themeTarget === theme;
          dot.classList.toggle('active', active);
          dot.setAttribute('aria-pressed', String(active));
        });

        // Re-render slider fills with new color
        setSliderFill(ttlSlider);
        setSliderFill(viewsSlider);

        // Update passphrase indicator if enabled
        if (passphraseEnabled) updatePpIndicator(true);
      }

      // Init from localStorage (HTML already applied data-theme to avoid FOUC)
      const savedTheme = localStorage.getItem('deadrop-theme') as 'green' | 'red' | null;
      applyTheme(savedTheme === 'red' ? 'red' : 'green', false);

      themeDots.forEach(dot => {
        dot.addEventListener('click', () => {
          applyTheme(dot.dataset.themeTarget as 'green' | 'red');
        });
      });

      // ── Char counter ────────────────────────────────────────────────────────────
      secretInput.addEventListener('input', () => {
        charCount.textContent = `${secretInput.value.length.toLocaleString()} / 10,000`;
      });

      // ── Password generator ──────────────────────────────────────────────────────
      genBtn.addEventListener('click', () => {
        const pw = generatePassword(20);
        secretInput.value = pw;
        charCount.textContent = `${pw.length} / 10,000`;
        secretInput.focus();
      });

      // ── Slider fill ─────────────────────────────────────────────────────────────
      function setSliderFill(el: HTMLInputElement) {
        const min = parseInt(el.min) || 0;
        const max = parseInt(el.max);
        const pct = ((parseInt(el.value) - min) / (max - min)) * 100;
        el.style.background = `linear-gradient(to right, ${accentColor} ${pct}%, #1A1A2E ${pct}%)`;
      }

      ttlSlider.addEventListener('input', () => {
        ttlDisplay.textContent = TTL_OPTIONS[parseInt(ttlSlider.value)].label;
        setSliderFill(ttlSlider);
      });
      setSliderFill(ttlSlider);

      viewsSlider.addEventListener('input', () => {
        const v = parseInt(viewsSlider.value);
        viewsDisplay.textContent = v === 1 ? '1 VIEW' : `${v} VIEWS`;
        setSliderFill(viewsSlider);
      });
      setSliderFill(viewsSlider);

      // ── Passphrase toggle ───────────────────────────────────────────────────────
      function updatePpIndicator(enabled: boolean) {
        ppIndicator.textContent = enabled ? '✓' : '';
        ppIndicator.style.color = enabled ? accentColor : '';
        ppIndicator.style.borderColor = enabled ? accentColor : '';
        ppIndicator.style.boxShadow = enabled ? `0 0 6px rgba(var(--accent-rgb), 0.4)` : '';
      }

      ppToggle.addEventListener('click', () => {
        passphraseEnabled = !passphraseEnabled;
        ppField.classList.toggle('hidden', !passphraseEnabled);
        updatePpIndicator(passphraseEnabled);
        if (passphraseEnabled) ppInput.focus();
      });

      // ── Create ──────────────────────────────────────────────────────────────────
      createBtn.addEventListener('click', async () => {
        const plaintext = secretInput.value.trim();
        if (!plaintext) { secretInput.focus(); return; }

        createBtn.disabled = true;
        createError.classList.add('hidden');

        try {
          const ttlSeconds = TTL_OPTIONS[parseInt(ttlSlider.value)].seconds;
          const viewLimit  = parseInt(viewsSlider.value);
          const passphrase = passphraseEnabled ? ppInput.value : '';

          let ciphertext: string, iv: string, fragment: string;

          if (passphrase) {
            createBtnText.textContent = 'DERIVING KEY...';
            const r = await encryptWithPassphrase(plaintext, passphrase);
            ciphertext = r.ciphertext; iv = r.iv; fragment = `p:${r.saltB64}`;
          } else {
            createBtnText.textContent = 'ENCRYPTING...';
            const r = await encryptSecret(plaintext);
            ciphertext = r.ciphertext; iv = r.iv; fragment = r.keyB64;
          }

          createBtnText.textContent = 'UPLOADING...';
          const res = await fetch('/api/secret', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ciphertext, iv, viewLimit, ttlSeconds }),
          });

          if (!res.ok) {
            const d = await res.json().catch(() => ({ error: 'Request failed' }));
            throw new Error(d.error || `Server error (${res.status})`);
          }

          const { id } = await res.json();
          resultLink.value = `${window.location.origin}/s/${id}#${fragment}`;
          const vLabel = viewLimit === 1 ? '1 VIEW' : `${viewLimit} VIEWS`;
          resultMeta.textContent = `BURNS AFTER ${vLabel} · ${TTL_OPTIONS[parseInt(ttlSlider.value)].label}`;

          createForm.classList.add('hidden');
          resultSection.classList.remove('hidden');
          resultSection.style.opacity = '0';
          resultSection.style.transform = 'translateY(10px)';
          requestAnimationFrame(() => {
            resultSection.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            resultSection.style.opacity = '1';
            resultSection.style.transform = 'translateY(0)';
          });

        } catch (err: any) {
          createError.textContent = err.message || 'Something went wrong. Please try again.';
          createError.classList.remove('hidden');
        } finally {
          createBtn.disabled = false;
          createBtnText.textContent = 'CREATE DEADROP →';
        }
      });

      // ── Copy ────────────────────────────────────────────────────────────────────
      async function copyLink() {
        try {
          await navigator.clipboard.writeText(resultLink.value);
          copyBtn.textContent = 'COPIED!';
          bigCopyBtn.textContent = '✓ COPIED';
          setTimeout(() => {
            copyBtn.textContent = 'COPY';
            bigCopyBtn.textContent = 'COPY LINK TO CLIPBOARD';
          }, 2000);
        } catch { resultLink.select(); }
      }
      copyBtn.addEventListener('click', copyLink);
      bigCopyBtn.addEventListener('click', copyLink);

      // ── Create another ──────────────────────────────────────────────────────────
      createAnother.addEventListener('click', () => {
        secretInput.value = '';
        charCount.textContent = '0 / 10,000';
        createError.classList.add('hidden');
        resultSection.classList.add('hidden');
        createForm.classList.remove('hidden');
        secretInput.focus();
      });
    </script>

  </body>
</html>
